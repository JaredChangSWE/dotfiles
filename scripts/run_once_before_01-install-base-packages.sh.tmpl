#!/bin/bash

set -euo pipefail

echo "ðŸ”§ Setting up core environment..."

{{- if eq .chezmoi.os "darwin" }}
if command -v brew >/dev/null 2>&1; then
    echo "ðŸº Homebrew is already installed, skipping installation..."
    echo "ðŸ“¦ Current Homebrew version: $(brew --version | head -n1)"
else
    echo "ðŸº Installing Homebrew..."
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    eval "$(/opt/homebrew/bin/brew shellenv)"

    echo "âœ… Homebrew installation completed!"
fi

echo ""
echo "ðŸ’¡ Next steps:"
echo "   â€¢ Taps and packages will be configured via Brewfile"
echo "   â€¢ Run 'brew bundle install --file Brewfile' to install all packages"
{{- end }}

{{- if eq .chezmoi.os "linux" }}
if ! command -v apt-get >/dev/null 2>&1; then
    echo "apt-get was not found. Skipping base package installation."
    exit 0
fi

echo "ðŸ“¦ Installing base Linux packages via apt..."

sudo apt-get update
sudo apt-get install -y \
    build-essential \
    ca-certificates \
    curl \
    file \
    git \
    gnupg \
    lsb-release \
    software-properties-common \
    unzip \
    wget \
    xdg-utils \
    xz-utils

echo "âœ… Core dependencies installed."
{{- end }}
